<Perl>
use lib qw(/www/www.thecoaches.com/lib/perl);
</Perl>


PerlRequire /www/www.thecoaches.com/lib/perl/handler-cti-09.pl
<VirtualHost *:80>
    ServerAdmin info@coactive.com
    ServerName  coactive.com
    ServerAlias www.coactive.com

    ServerAlias thecoaches.com
    ServerAlias www.thecoaches.com
    ServerAlias thecoaches.modelsmith.com
    ServerAlias json.coaching-courses.com


    DirectoryIndex "index.html" "index.php"
    DocumentRoot /www/www.thecoaches.com/ee_newsletter
    #DocumentRoot /www/www.thecoaches.com/docs
    ErrorDocument 404 /error404.html  
    CustomLog '|/usr/sbin/rotatelogs "/www/www.thecoaches.com/logs/access_log" 604800' "%h %l %u %t \"%r\" %>s %b \"%{Referer}i\" \"%{User-Agent}i\""
    ErrorLog '|/usr/sbin/rotatelogs "/www/www.thecoaches.com/logs/error_log" 604800'



    RewriteEngine on
    # redirect to www.thecoaches.com
    RewriteCond %{HTTP_HOST} !^www.thecoaches\.com  [NC]
    RewriteCond %{HTTP_HOST} !^$
    RewriteCond %{REQUEST_URI} !^/googlec34cfa5bdae43e39.html
    RewriteRule ^/(.*) http://www.thecoaches.com/$1 [R=302,L]

# CDN for email blasts
#RewriteCond %{HTTP_USER_AGENT} !^CoralWebPrx
#RewriteCond %{QUERY_STRING} !(^|&)coral-no-serve$
#RewriteRule ^/docs/emails/ctius/images(.*)$ http://www.thecoaches.com.nyud.net:8080/docs/emails/ctius/images$1 [R,L]

#RewriteCond %{HTTP_USER_AGENT} !^CoralWebPrx
#RewriteCond %{QUERY_STRING} !(^|&)coral-no-serve$
#RewriteRule ^/email/images(.*)$ http://www.thecoaches.com.nyud.net:8080/email/images$1 [R,L]

#RewriteCond %{HTTP_USER_AGENT} !^CoralWebPrx
#RewriteCond %{QUERY_STRING} !(^|&)coral-no-serve$
#RewriteRule ^/emails/marketing-2011-12/images(.*)$ http://www.thecoaches.com.nyud.net:8080/emails/marketing-2011-12/images$1 [R,L]

#RewriteCond %{HTTP_USER_AGENT} !^CoralWebPrx
#RewriteCond %{QUERY_STRING} !(^|&)coral-no-serve$
#RewriteRule ^/images/uploads(.*)$ http://www.thecoaches.com.nyud.net:8080/images/uploads$1 [R,L]

#RewriteCond %{HTTP_USER_AGENT} !^CoralWebPrx
#RewriteCond %{QUERY_STRING} !(^|&)coral-no-serve$
  #RewriteRule ^/ee_newsletter/images/uploads(.*)$ http://www.thecoaches.com.nyud.net:8080/ee_newsletter/images/uploads$1 [R,L]



  # if it is not /blog* AND ends in / ...
  RewriteCond %{REQUEST_URI} !^/(blog|corporate|corporate_sandbox|coachingportal|henry-radio|mktcal|karen-huffpost|data|portal|wol|learning-hub|leadershiptribe|vision|webinar-access)
  RewriteCond %{REQUEST_URI} ^(.*)/$
  RewriteRule ^(.*)/$ $1/index.html

  RewriteCond %{HTTP_HOST} ^www\.cti(biz|business)builder\.(com|net)
  RewriteRule ^/(.*) http://www.thecoaches.com/coach-training/business-builder/ [R=302,L]

  RewriteCond %{HTTP_HOST} ^www\.businessbuilderonline\.com
  RewriteRule ^/(.*) http://www.thecoaches.com/coach-training/business-builder/ [R=302,L]

  # rewrites for coactivenetwork.com links
  RewriteRule ^/resources/ /coach-training/resources [R=301,L]
  RewriteRule ^/leaders/ /coach-training/faculty  [R=301,L]
  RewriteRule ^/organizations /for-organizations  [R=301,L]

  # new rewrites as of Oct 23, 2012 T. Beutel
  RewriteRule ^/issues http://54.227.253.68/trac/Project [R=302,L]

  RewriteRule ^/info/catalog-for-california /docs/pdfs/Catalogue-for-California.pdf [R=302,L]
  RewriteRule ^/info/school-performance-fact-sheet-for-california /docs/pdfs/school-performance-fact-sheet-for-calif.pdf [R=302,L]
  RewriteRule ^/info/annual-report-for-california /docs/pdfs/BPPE-ANNUAL-REPORT-2014.pdf [R=302,L]



  RewriteRule ^/FORLaudition http://ww2.thecoaches.com/scholarship/index.php/flexform/login [R=302,L]
  RewriteRule ^/FORLfee /docs/forlfee.html [R=302,L]

  RewriteRule ^/learning-hub/fr/(.*) http://www.ctifrance.com/learning-hub/fr/$1 [R=302,L]
  RewriteRule ^/toolkit2/index.html /docs/toolkit2/index.html [R=302,L]

  RewriteRule ^/courses$ /coach-training/core-courses  [R=302,L]
  RewriteRule ^/coach-training/courses$ /coach-training/core-courses [R=302,L]
  RewriteRule ^/coach-training/courses/(.*) /coach-training/core-courses/$1 [R=302,L]
  RewriteRule ^/coach-training/core-courses/fast-track$ /coach-training/core-courses/fast-track-option [R=302,L]

  RewriteRule ^/resources/toolkit/pdfs/31-Powerful-Questions.pdf /docs/resources/toolkit/pdfs/31-Powerful-Questions.pdf [R=302,L]
  RewriteRule ^/resources/multimedia/two-free-chapters-co-active-coaching.html /why-cti/buy-the-book [R=302,L]

  RewriteRule ^/coach-training/building-business/the-leadership-circle$ /coach-training/business-success-training/the-leadership-circle/ [R=302,L]
  RewriteRule ^/coach-training/building-business/the-leadership-circle/(.*) /coach-training/business-success-training/the-leadership-circle/$1 [R=302,L]

  RewriteRule ^/leadership/faqs$ /leadership/program-faqs [R=302,L]
  RewriteRule ^/why-cti/accreditation-faqs$ /why-cti/accreditations-affiliations [R=302,L]
  RewriteRule ^/leadership/accreditation-faqs$ /leadership/college-equivalence [R=302,L]

  Rewriterule ^/coach-training/resources/newsletter-archive /community/co-active-global-newsletter [R=302,L]
  RewriteRule ^/cti-international /why-cti/cti-international [R=302,L]

  RewriteRule ^/homework-information.html /docs/homework-information.html [R=302,L]
  RewriteRule ^/agility.html /for-organizations/relationship-agility [R=302,L]
  RewriteRule ^/agility /for-organizations/relationship-agility [R=302,L]
  RewriteRule ^/toolkit(\.html)? /docs/resources/toolkit/index.html [R=302,L]
  RewriteRule ^/resources/toolkit(.*) /docs/resources/toolkit/index.html [R=302,L]

  RewriteRule ^/3rdeditionspecial(\.html|offer\.html)? /docs/coach-training/fundamentals/coactivebook.html [R=302,L]


  RewriteRule ^/coach-training/courses/bigger-game.html /docs/coach-training/courses/bigger-game.html [R=302,L]
  RewriteRule ^/why-coaches-training-institute/ /why-cti [R=302,L]
  RewriteRule ^/why-coaches-training-institute/ /why-cti [R=302,L]
  RewriteRule ^/coach-training/dates-and-locations/  /coach-training/dates-locations [R=302,L]

  RewriteRule ^/resources/thinkpal(.*) /docs/resources/thinkpal/index.html [R=302,L]
  RewriteRule ^/resources/thinkpal/CTI-app-button-black.png  /docs/resources/thinkpal/CTI-app-button-black.png [R=302,L]
  RewriteRule ^/resources/thinkpal/CTI-app-button-steel.png  /docs/resources/thinkpal/CTI-app-button-black.png [R=302,L]

  RewriteRule ^/scholarship /docs/scholarship/index.html [R=302,L]
  RewriteRule ^/docs/scholarship/$ /docs/scholarship/index.html [R=302,L]
  RewriteRule ^/leadership/creating-from-self(.*) /leadership/leadership-discovery [R=302,L]

  RewriteRule ^/international(.*) /cti-international [R=302,L]
  RewriteRule ^/coach-training/certification/registration.html /coach-training/certification/registration-and-application-process [R=302,L]
  RewriteRule ^/cti-coach-match(.*) http://ww2.thecoaches.com/index.php [R=302,L]
  RewriteRule ^/leadership/launchpad/(.*) /docs/leadership/launchpad/$1 [R=302,L]

  RewriteRule ^/res/(.*) /docs/res/$1 [R=302,L]
  RewriteRule ^/pdfs/(.*) /docs/pdfs/$1 [R=302,L]
  RewriteRule ^/emails/(.*) /docs/emails/$1 [R=302,L]
  RewriteRule ^/_temp/(.*) /docs/_temp/$1 [R=302,L]
  RewriteRule ^/student/(.*) /docs/student/$1 [R=302,L]
  RewriteRule ^/docs/learning-hub/(.*) /learning-hub/$1 [R=302,L]
  RewriteRule ^/docs/leadershiptribe/(.*) /leadershiptribe/$1 [R=302,L]
  RewriteRule ^/coach-training/building-business/index.html\%23coactiveexec /coach-training/building-business\%23executive_coaching [R,NE,L]
  RewriteRule ^/coach-training/building-business/index.html /coach-training/building-business [R=302,L]

  RewriteRule ^/(cpcc[sml]).js$ /data/$1.js [R=302,L]
  RewriteRule ^/resources/partners/cpcc-logo.html /docs/resources/partners/cpcc-logo.html [R=302,L]

  RewriteRule ^/ee_newsletter/images/CtiLanding.jpg /docs/images/CtiLanding.jpg [R=302,L]
  RewriteRule ^/ee_newsletter/images/CtiLanding_02.jpg /docs/images/CtiLanding_02.jpg [R=302,L]
  RewriteRule ^/ee_newsletter/images/pricing_and_registration.gif /docs/images/pricing_and_registration.gif [R=302,L]
  RewriteRule ^/ee_newsletter/images/more_info_sm.gif /docs/images/more_info_sm.gif [R=302,L]

  # older rewrites
  Rewriterule ^/coach-training/business-builder/(.*) /coach-training/building-business/$1 [R=302,L]

  RewriteRule ^/portal/index.php/$ /portal/index.php [R=302,L]

  RewriteRule ^/coactive-sales/$ /coach-training/building-business/ [R=302,L]
  RewriteRule ^/coactive-sales/index.html$ /coach-training/building-business/ [R=302,L]

  RewriteRule /coach-training/fundamentals/gcampaign(..*)\.html /docs/coach-training/fundamentals/gcampaign.html?r=$1
  RewriteRule /coach-training/fundamentals/scampaign(..*)\.html /docs/coach-training/fundamentals/scampaign.html?r=$1
  RewriteRule /coach-training/fundamentals/lcampaign(..*)\.html /docs/coach-training/fundamentals/lcampaign.html?r=$1
  RewriteRule /docs/coach-training/fundamentals/gcampaign(..*)\.html /docs/coach-training/fundamentals/gcampaign.html?r=$1
  RewriteRule /docs/coach-training/fundamentals/scampaign(..*)\.html /docs/coach-training/fundamentals/scampaign.html?r=$1
  RewriteRule /docs/coach-training/fundamentals/lcampaign(..*)\.html /docs/coach-training/fundamentals/lcampaign.html?r=$1
  RewriteRule ^/coach-training/fundamentals/(.*) /docs/coach-training/fundamentals/$1 [R=302,L]
  #RewriteRule ^/coach-training/fundamentals/campaign2.html /docs/coach-training/fundamentals/campaign2.html [R=302,L]

  RewriteRule /cti_newsletter/(.*) /docs/epub/docs/$1 [R=302,L]

  RewriteRule /coaching/free-info-call.html /contact/schedule-a-call/ [R=302,L]


  # types for Microsoft
  AddType application/vnd.ms-word.document.macroEnabled.12 .docm
  AddType application/vnd.openxmlformats-officedocument.wordprocessingml.document docx
  AddType application/vnd.openxmlformats-officedocument.wordprocessingml.template dotx
  AddType application/vnd.ms-powerpoint.template.macroEnabled.12 potm
  AddType application/vnd.openxmlformats-officedocument.presentationml.template potx
  AddType application/vnd.ms-powerpoint.addin.macroEnabled.12 ppam
  AddType application/vnd.ms-powerpoint.slideshow.macroEnabled.12 ppsm
  AddType application/vnd.openxmlformats-officedocument.presentationml.slideshow ppsx
  AddType application/vnd.ms-powerpoint.presentation.macroEnabled.12 pptm
  AddType application/vnd.openxmlformats-officedocument.presentationml.presentation pptx
  AddType application/vnd.ms-excel.addin.macroEnabled.12 xlam
  AddType application/vnd.ms-excel.sheet.binary.macroEnabled.12 xlsb
  AddType application/vnd.ms-excel.sheet.macroEnabled.12 xlsm
  AddType application/vnd.openxmlformats-officedocument.spreadsheetml.sheet xlsx
  AddType application/vnd.ms-excel.template.macroEnabled.12 xltm
  AddType application/vnd.openxmlformats-officedocument.spreadsheetml.template xltx

  ExpiresActive On
  ExpiresByType text/css "access plus 2 days"
  ExpiresByType application/pdf "access plus 15 minutes"
  ExpiresByType image/gif "access plus 1 month"
  ExpiresByType image/jpg "access plus 1 month"
  ExpiresByType image/png "access plus 1 month"

  ScriptAlias /cgi-bin /www/www.thecoaches.com/cgi-bin
  <Directory "/www/www.thecoaches.com/cgi-bin">
      Order deny,allow
      Allow from all
    </Directory>
# Expression Engine
    Alias /ee_newsletter /www/www.thecoaches.com/ee_newsletter    
    <Directory "/www/www.thecoaches.com/ee_newsletter">
      Order deny,allow
      Allow from all
      Options All -Indexes -Includes +MultiViews
      AllowOverride All
    </Directory>

# Webinar Access
    Alias /webinar-access /www/www.thecoaches.com/webinar-access
    <Directory "/www/www.thecoaches.com/webinar-access">
      Order deny,allow
      Allow from all
      Options All -Indexes -Includes +MultiViews
      AllowOverride All
    </Directory>

# Expression Engine
    Alias /vision /www/www.thecoaches.com/vision    
    <Directory "/www/www.thecoaches.com/vision">
      Order deny,allow
      Allow from all
      Options All -Indexes -Includes +MultiViews
      AllowOverride All
    </Directory>


# /docs
    Alias /docs /www/www.thecoaches.com/docs
    <Directory "/www/www.thecoaches.com/docs">
        Order deny,allow
        Allow from all
        SetHandler perl-script
        PerlHandler CTI09::ApacheHandler
        <FilesMatch "(\.mas|handler)$">
          SetHandler None
	  Order allow,deny
          Deny from all
        </FilesMatch>
        <FilesMatch "\.(gif|png|jpg|css|doc|docx|ppt|pdf|zip|swf|flv)$">
          SetHandler None
        </FilesMatch>
      Options All +Indexes -Includes +MultiViews
      AllowOverride All
    </Directory>



# /email (directory)
    Alias /email /www/www.thecoaches.com/email    
    <Directory "/www/www.thecoaches.com/email">
      Order deny,allow
      Allow from all
      Options All +Indexes -Includes +MultiViews
      AllowOverride All
    </Directory>

# /blog (WORDPRESS)
    Alias /blog /www/www.thecoaches.com/blog    
    <Directory "/www/www.thecoaches.com/blog">
      Order deny,allow
      Allow from all
      Options All +Indexes -Includes +MultiViews
      AllowOverride All
    </Directory>
# /henry-radio (WORDPRESS)
    Alias /henry-radio /www/www.thecoaches.com/henry-radio
    <Directory "/www/www.thecoaches.com/henry-radio">
      Order deny,allow
      Allow from all
      Options All +Indexes -Includes +MultiViews
      AllowOverride All
    </Directory>
# /karen-huffpost (WORDPRESS)
    Alias /karen-huffpost /www/www.thecoaches.com/karen-huffpost
    <Directory "/www/www.thecoaches.com/karen-huffpost">
      Order deny,allow
      Allow from all
      Options All +Indexes -Includes +MultiViews
      AllowOverride All
    </Directory>
# /data (PHP)
    Alias /data /www/www.thecoaches.com/data
    <Directory "/www/www.thecoaches.com/data">
      Order deny,allow
      Allow from all
      Options All +Indexes -Includes
      AllowOverride All
    </Directory>

# /wol (PHP)
    Alias /wol /www/www.thecoaches.com/wol
    <Directory "/www/www.thecoaches.com/wol">
      Order deny,allow
      Allow from all
      Options All +Indexes -Includes
      AllowOverride All
    </Directory>

# /portal - Student Portal (Symfony 1.2 project)
    Alias /portal /www/www.thecoaches.com/portal/web    
    <Directory "/www/www.thecoaches.com/portal/web">
      Order deny,allow
      Allow from all
      Options All +Indexes -Includes +MultiViews
      AllowOverride All
    </Directory>

# /mktcal - Marketing Calendar (Symfony 1.2 project)
    Alias /mktcal /www/www.thecoaches.com/mktcal/web    
    <Directory "/www/www.thecoaches.com/mktcal/web">
      Order deny,allow
      Allow from all
      Options All +Indexes -Includes +MultiViews
      AllowOverride All
        AuthName Restricted
        AuthType Basic
        AuthUserFile /www/www.thecoaches.com/etc/.htpasswd
        Require user coactive
    </Directory>

# /surveys - Student Portal (Symfony 1.2 project)
    Alias /surveys /www/www.thecoaches.com/surveys/web    
    <Directory "/www/www.thecoaches.com/surveys/web">
      Order deny,allow
      Allow from all
      Options All +Indexes -Includes +MultiViews
      AllowOverride All
    </Directory>

# /coactive-sales-class - Coactive Sales Project (Symfony 1.2 project)
    Alias /coactive-sales-class /www/www.thecoaches.com/coactive-sales/web    
    <Directory "/www/www.thecoaches.com/coactive-sales/web">
      Order deny,allow
      Allow from all
      Options All +Indexes -Includes +MultiViews
      AllowOverride All
    </Directory>

# /coactive-marketing-class - Coactive Marketing Project (Symfony 1.2 project)
    Alias /coactive-marketing-class /www/www.thecoaches.com/coactive-marketing/web    
    <Directory "/www/www.thecoaches.com/coactive-marketing/web">
      Order deny,allow
      Allow from all
      Options All +Indexes -Includes +MultiViews
      AllowOverride All
    </Directory>

# /corporate
    Alias /corporate /www/www.thecoaches.com/corporate
    Alias /coachingportal /www/www.thecoaches.com/corporate
    <Directory "/www/www.thecoaches.com/corporate">
      Order deny,allow
      Allow from all
      Options All +Indexes -Includes +MultiViews
      AllowOverride All
    </Directory>

# /corporate_sandbox
    Alias /corporate_sandbox /www/www.thecoaches.com/corporate_sandbox

    <Directory "/www/www.thecoaches.com/corporate_sandbox">
      Order deny,allow
      Allow from all
      Options All +Indexes -Includes +MultiViews
      AllowOverride All
    </Directory>

# /learning-hub
    Alias /learning-hub /www/www.thecoaches.com/learning-hub
    <Directory "/www/www.thecoaches.com/learning-hub">
      AddType        application/x-httpd-php .html      
      Order deny,allow
      Allow from all
      Options All +Indexes -Includes +MultiViews
      AllowOverride All
    </Directory>

# /launchpad
    Alias /launchpad /www/www.thecoaches.com/launchpad
    <Directory "/www/www.thecoaches.com/launchpad">
      AddType        application/x-httpd-php .html      
      Order deny,allow
      Allow from all
      Options All +Indexes -Includes +MultiViews
      AllowOverride All
    </Directory>
    <Directory "/www/www.thecoaches.com/launchpad/es/adm">
        AuthName Restricted
        AuthType Basic
        AuthUserFile /www/www.thecoaches.com/etc/.htpasswd
        Require user lpadmin
    </Directory>

  # /leadership tribe
  Alias /leadershiptribe /www/www.thecoaches.com/leadershiptribe
  <Directory "/www/www.thecoaches.com/leadershiptribe">
    AddType        application/x-httpd-php .html
    Order deny,allow
    Allow from all
    Options All +Indexes -Includes +MultiViews
    AllowOverride All
  </Directory>

# /CI_test - Codeigniter test
    Alias /CI_test /www/www.thecoaches.com/CI_test    
    <Directory "/www/www.thecoaches.com/CI_test">
      Order deny,allow
      Allow from all
      Options All +Indexes -Includes +MultiViews
      AllowOverride All
    </Directory>


# /mailchimp
    Alias /mailchimp /www/www.thecoaches.com/mailchimp    
    <Directory "/www/www.thecoaches.com/mailchimp">
      Order deny,allow
      Allow from all
      Options All +Indexes -Includes +MultiViews
      AllowOverride All
    </Directory>

# /internal
    Alias /internal /www/www.thecoaches.com/internal
    <Directory "/www/www.thecoaches.com/internal">
      Order deny,allow
      Allow from all
      Options All +Indexes -Includes +MultiViews
      AllowOverride All
    </Directory>


    <Directory "/www/www.thecoaches.com/docs/coach-training/course-materials/">
        AuthName Restricted
        AuthType Basic
        AuthUserFile /www/www.thecoaches.com/etc/.htpasswd
        Require user coactive
    </Directory>

    <Directory "/www/www.thecoaches.com/docs/training-hub/">
        AuthName Restricted
        AuthType Basic
        AuthUserFile /www/www.thecoaches.com/etc/.htpasswd
        Require user coactive
    </Directory>

    <Directory "/www/www.thecoaches.com/docs/coach-training/business-builder/multimedia/">
        AuthName Restricted
        AuthType Basic
        AuthUserFile /www/www.thecoaches.com/etc/.htpasswd
        Require user coactive
    </Directory>


    <DirectoryMatch ".*\/js\/">
        <FilesMatch "\.(js)$">
          SetHandler None
        </FilesMatch>
    </DirectoryMatch>

</VirtualHost>
